{
	"variables": {
		"availability_zone": "{{ env `AVAILABILITY_ZONE` }}",
		"device_name": "/dev/sdf",
		"instance_type": "t2.nano",
		"region": "{{ env `AWS_REGION` }}",
		"security_group_ids": "{{ env `INSTANCE_SECURITY_GROUPS` }}",
		"source_bucket": "{{ env `SOURCE_BUCKET` }}",
		"ssh_user": "ec2-user",
		"subnet_id": "{{ env `INSTANCE_SUBNET` }}",
		"vpc_id": "{{ env `INSTANCE_VPC` }}"
	},
	"provisioners": [
		{
			"type": "shell",
			"inline": [
				"pacman --color never --noprogressbar --noconfirm -Sqy python"
			]
		},
		{
			"type": "ansible",
			"playbook_file": "playbook-volume.yaml",
			"groups": [
				"common"
			],
			"user": "{{ user `ssh_user` }}",
			"extra_arguments": [
				"-vvv",
				"--extra-vars",
				"dev={{ user `device_name` }}"
			]
		}
	],
	"builders": [
		{
			"type": "amazon-ebsvolume",
			"associate_public_ip_address": false,
			"availability_zone": "{{ user `region` }}{{ user `availability_zone` }}",
			"ebs_volumes": [
				{
					"delete_on_termination": false,
					"device_name": "{{ user `device_name` }}",
					"volume_size": 1,
					"volume_type": "gp2"
				}
			],
			"instance_type": "{{ user `instance_type` }}",
			"region": "{{ user `region` }}",
			"run_tags": {
				"Packer": "music-volume"
			},
			"security_group_ids": "{{ user `security_group_ids` }}",
			"source_ami_filter": {
				"filters": {
					"name": "arch-linux-hvm-*.x86_64-ebs",
					"root-device-type": "ebs",
					"virtualization-type": "hvm"
				},
				"owners": [
					"093273469852"
				],
				"most_recent": true
			},
			"ssh_interface": "private_ip",
			"ssh_keypair_name": "music-packer",
			"ssh_private_key_file": "music-packer.pem",
			"ssh_username": "{{ user `ssh_user` }}",
			"subnet_id": "{{ user `subnet_id` }}",
			"vpc_id": "{{ user `vpc_id` }}"
		}
	],
	"post-processors": [
		{
			"type": "manifest",
			"output": "manifest.json",
			"strip_path": true
		}
	]
}
