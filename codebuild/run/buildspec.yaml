---
version: 0.2

phases:
   build:
      commands:
         - aws s3 sync --quiet "s3://${SOURCE_BUCKET}" codebuild/run/build
         - mv -ft codebuild/run/build -- tup/*
         - cd codebuild/run/build
         - mkdir build
         - aws --query 'Parameter.Value' --output text ssm get-parameter --name "/vibes/profiles/${PROFILE}" >build/tup.config
         - tup build
         - rm -- build/tup.config

artifacts:
   base-directory: codebuild/run/build/build
   files:
      - '**/*'
   discard-paths: no
